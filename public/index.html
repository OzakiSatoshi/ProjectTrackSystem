<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¡ˆä»¶ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .actions {
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        button.secondary {
            background: #95a5a6;
        }
        
        button.secondary:hover {
            background: #7f8c8d;
        }
        
        button.danger {
            background: #e74c3c;
        }
        
        button.danger:hover {
            background: #c0392b;
        }
        
        input, select, textarea {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .anken-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 20px;
            padding: 20px;
        }
        
        .anken-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 20px;
            border: 1px solid #e0e0e0;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .anken-card:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }
        
        .anken-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        
        .anken-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin: 0;
            line-height: 1.3;
        }
        
        .anken-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px 16px;
            margin-bottom: 16px;
        }
        
        .anken-info-item {
            display: flex;
            flex-direction: column;
        }
        
        .anken-info-label {
            font-size: 11px;
            font-weight: 500;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 2px;
        }
        
        .anken-info-value {
            font-size: 14px;
            color: #333;
            font-weight: 500;
        }
        
        .anken-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 16px;
        }
        
        .anken-tag {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            background: #f0f2f5;
            color: #5a6c7d;
        }
        
        .anken-actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            padding-top: 12px;
            border-top: 1px solid #f0f0f0;
        }
        
        .anken-actions button {
            padding: 6px 12px;
            font-size: 12px;
        }
        
        .table-container {
            display: none;
        }
        
        .status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-1 { background: #e3f2fd; color: #1976d2; }
        .status-2 { background: #e8f5e8; color: #388e3c; }
        .status-3 { background: #f3e5f5; color: #7b1fa2; }
        .status-4 { background: #fff3e0; color: #f57c00; }
        
        .telework-status {
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 500;
        }
        
        tr:hover td {
            background: #f8f9fa;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 20px;
            width: 90%;
            max-width: 600px;
            border-radius: 8px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .close {
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .actions {
                flex-direction: column;
                align-items: stretch;
            }
            
            .anken-grid {
                grid-template-columns: 1fr;
                gap: 16px;
                padding: 16px;
            }
            
            .anken-card {
                padding: 16px;
            }
            
            .anken-title {
                font-size: 16px;
            }
            
            .anken-info {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .modal-content {
                margin: 10% auto;
                width: 95%;
            }
            
            /* Mobile search filters - stack vertically */
            .card div[style*="grid-template-columns"] {
                grid-template-columns: 1fr !important;
                gap: 10px !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>æ¡ˆä»¶ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
            <p>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€é€£çµ¡å…ˆã€ãŠã‚ˆã³å–å¼•å…ˆã®ç®¡ç†</p>
        </header>
        
        <div class="actions">
            <button onclick="showSection('anken')">æ¡ˆä»¶ä¸€è¦§</button>
            <button onclick="showSection('contacts')" class="secondary">æ‹…å½“è€…ä¸€è¦§</button>
            <button onclick="showSection('accounts')" class="secondary">å–å¼•å…ˆä¸€è¦§</button>
            <button onclick="openModal('ankenModal')" class="secondary">æ–°è¦æ¡ˆä»¶ä½œæˆ</button>
            <button onclick="loadData()" class="secondary">æ›´æ–°</button>
        </div>
        
        <!-- Anken Section -->
        <div id="ankenSection" class="section">
            <!-- Search and Filter Panel -->
        <div class="card" style="margin-bottom: 20px;">
            <div style="padding: 20px;">
                <h3 style="margin: 0 0 15px 0; color: #2c3e50;">æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="searchText">æ¡ˆä»¶åãƒ»è©³ç´°</label>
                        <input type="text" id="searchText" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢..." onInput="applyFilters()">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="filterLocation">å‹¤å‹™åœ°</label>
                        <input type="text" id="filterLocation" placeholder="å‹¤å‹™åœ°ã§æ¤œç´¢..." onInput="applyFilters()">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="filterKen">éƒ½é“åºœçœŒ</label>
                        <select id="filterKen" onchange="applyFilters()">
                            <option value="">ã™ã¹ã¦</option>
                            <option value="æ±äº¬éƒ½">æ±äº¬éƒ½</option>
                            <option value="å¤§é˜ªåºœ">å¤§é˜ªåºœ</option>
                            <option value="æ„›çŸ¥çœŒ">æ„›çŸ¥çœŒ</option>
                            <option value="ç¦å²¡çœŒ">ç¦å²¡çœŒ</option>
                            <option value="ãƒªãƒ¢ãƒ¼ãƒˆ">ãƒªãƒ¢ãƒ¼ãƒˆ</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="filterProgram">ãƒ—ãƒ­ã‚°ãƒ©ãƒ è¨€èª</label>
                        <input type="text" id="filterProgram" placeholder="Java, Python..." onInput="applyFilters()">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="filterPlatform">ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ </label>
                        <input type="text" id="filterPlatform" placeholder="Web, Mobile..." onInput="applyFilters()">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="filterProcess">å·¥ç¨‹</label>
                        <input type="text" id="filterProcess" placeholder="è¨­è¨ˆ, é–‹ç™º..." onInput="applyFilters()">
                    </div>

                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="filterTelework">ãƒ†ãƒ¬ãƒ¯ãƒ¼ã‚¯ <small style="color: #999; font-size: 10px;">(ã€‡:ãƒ•ãƒ« â–³:éƒ¨åˆ† âœ•:å¸¸é§)</small></label>
                        <select id="filterTelework" onchange="applyFilters()">
                            <option value="">ã™ã¹ã¦</option>
                            <option value="full">ã€‡</option>
                            <option value="partial">â–³</option>
                            <option value="none">âœ•</option>
                        </select>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button onclick="clearFilters()" class="secondary" style="padding: 8px 16px;">ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¯ãƒªã‚¢</button>
                    <span id="resultCount" style="color: #666; font-size: 14px;"></span>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div id="ankenGrid" class="anken-grid">
                <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #666;">
                    èª­ã¿è¾¼ã¿ä¸­...
                </div>
            </div>
        </div>
        </div>

        <!-- Contacts Section -->
        <div id="contactsSection" class="section" style="display: none;">
            <div class="card" style="margin-bottom: 20px;">
                <div style="padding: 20px;">
                    <h3 style="margin: 0 0 15px 0; color: #2c3e50;">æ‹…å½“è€…ä¸€è¦§</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="contactSearchText">æ°åãƒ»å½¹è·</label>
                            <input type="text" id="contactSearchText" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢..." onInput="applyContactFilters()">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="contactAccountFilter">å–å¼•å…ˆ</label>
                            <select id="contactAccountFilter" onchange="applyContactFilters()">
                                <option value="">ã™ã¹ã¦</option>
                            </select>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <button onclick="openModal('contactModal')" class="secondary">æ‹…å½“è€…è¿½åŠ </button>
                    </div>
                </div>
            </div>
            <div id="contactsGrid" class="anken-grid">
                <!-- Contacts will be loaded here -->
            </div>
        </div>

        <!-- Accounts Section -->
        <div id="accountsSection" class="section" style="display: none;">
            <div class="card" style="margin-bottom: 20px;">
                <div style="padding: 20px;">
                    <h3 style="margin: 0 0 15px 0; color: #2c3e50;">å–å¼•å…ˆä¸€è¦§</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="accountSearchText">ä¼šç¤¾åãƒ»æ¥­ç•Œ</label>
                            <input type="text" id="accountSearchText" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢..." onInput="applyAccountFilters()">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="industryFilter">æ¥­ç•Œ</label>
                            <select id="industryFilter" onchange="applyAccountFilters()">
                                <option value="">ã™ã¹ã¦</option>
                            </select>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <button onclick="openModal('accountModal')" class="secondary">å–å¼•å…ˆè¿½åŠ </button>
                    </div>
                </div>
            </div>
            <div id="accountsGrid" class="anken-grid">
                <!-- Accounts will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Anken Modal -->
    <div id="ankenModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="ankenModalTitle">æ¡ˆä»¶ä½œæˆ</h3>
                <span class="close" onclick="closeModal('ankenModal')">&times;</span>
            </div>
            <form id="ankenForm">
                <div class="form-group">
                    <label for="anken_name">æ¡ˆä»¶å *</label>
                    <input type="text" id="anken_name" required>
                </div>
                <div class="form-group">
                    <label for="contact_id">æ‹…å½“è€…</label>
                    <select id="contact_id">
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="detail">è©³ç´°</label>
                    <textarea id="detail" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="notes">å‚™è€ƒ</label>
                    <textarea id="notes" rows="2"></textarea>
                </div>

                <h4 style="margin: 20px 0 10px 0; color: #333; border-bottom: 1px solid #eee; padding-bottom: 5px;">æœŸé–“ãƒ»ä¾¡æ ¼</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label for="start_date">é–‹å§‹æ—¥</label>
                        <input type="date" id="start_date">
                    </div>
                    <div class="form-group">
                        <label for="end_date">çµ‚äº†æ—¥</label>
                        <input type="date" id="end_date">
                    </div>
                    <div class="form-group">
                        <label for="limit_date">ç· åˆ‡æ—¥</label>
                        <input type="date" id="limit_date">
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label for="price">ä¾¡æ ¼</label>
                        <input type="text" id="price" placeholder="Â¥1,000,000">
                    </div>
                    <div class="form-group">
                        <label for="contract">å¥‘ç´„å½¢æ…‹</label>
                        <input type="text" id="contract" placeholder="æº–å§”ä»»ã€è«‹è² ç­‰">
                    </div>
                </div>

                <h4 style="margin: 20px 0 10px 0; color: #333; border-bottom: 1px solid #eee; padding-bottom: 5px;">æŠ€è¡“è¦ä»¶</h4>
                <div class="form-group">
                    <label for="required_skills">å¿…é ˆã‚¹ã‚­ãƒ«</label>
                    <textarea id="required_skills" rows="2" placeholder="Java, Spring Boot, AWSç­‰"></textarea>
                </div>
                <div class="form-group">
                    <label for="nice_skills">æ­“è¿ã‚¹ã‚­ãƒ«</label>
                    <textarea id="nice_skills" rows="2" placeholder="Docker, Kubernetesç­‰"></textarea>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label for="process">å·¥ç¨‹</label>
                        <input type="text" id="process" placeholder="è¦ä»¶å®šç¾©ã€è¨­è¨ˆã€é–‹ç™º">
                    </div>
                    <div class="form-group">
                        <label for="program">ãƒ—ãƒ­ã‚°ãƒ©ãƒ è¨€èª</label>
                        <input type="text" id="program" placeholder="Java, Python, JavaScript">
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label for="platform">ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ </label>
                        <input type="text" id="platform" placeholder="AWS, Azure, GCP">
                    </div>
                    <div class="form-group">
                        <label for="framework">ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯</label>
                        <input type="text" id="framework" placeholder="Spring, React, Vue">
                    </div>
                    <div class="form-group">
                        <label for="db">ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹</label>
                        <input type="text" id="db" placeholder="MySQL, PostgreSQL, Oracle">
                    </div>
                </div>

                <h4 style="margin: 20px 0 10px 0; color: #333; border-bottom: 1px solid #eee; padding-bottom: 5px;">å‹¤å‹™æ¡ä»¶</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label for="location">å‹¤å‹™åœ°</label>
                        <input type="text" id="location" placeholder="æ±äº¬éƒ½æ¸‹è°·åŒºã€å¤§é˜ªåºœå¤§é˜ªå¸‚ç­‰">
                    </div>
                    <div class="form-group">
                        <label for="ken">éƒ½é“åºœçœŒ</label>
                        <input type="text" id="ken" placeholder="æ±äº¬éƒ½ã€å¤§é˜ªåºœç­‰">
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label for="time_from">é–‹å§‹æ™‚é–“</label>
                        <input type="time" id="time_from">
                    </div>
                    <div class="form-group">
                        <label for="time_to">çµ‚äº†æ™‚é–“</label>
                        <input type="time" id="time_to">
                    </div>
                    <div class="form-group">
                        <label for="telework_yn">ãƒ†ãƒ¬ãƒ¯ãƒ¼ã‚¯ <small style="color: #999; font-size: 10px;">(ã€‡:ãƒ•ãƒ« â–³:éƒ¨åˆ† âœ•:å¸¸é§)</small></label>
                        <select id="telework_yn">
                            <option value="">é¸æŠ</option>
                            <option value="0">âœ•</option>
                            <option value="1">â–³</option>
                            <option value="2">ã€‡</option>
                        </select>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label for="persons">äººæ•°</label>
                        <input type="text" id="persons" placeholder="2åã€3-5åç­‰">
                    </div>
                    <div class="form-group">
                        <label for="foreigner">å¤–å›½äººå¯å¦</label>
                        <select id="foreigner">
                            <option value="">é¸æŠ</option>
                            <option value="å¯">å¯</option>
                            <option value="ä¸å¯">ä¸å¯</option>
                            <option value="è¦ç›¸è«‡">è¦ç›¸è«‡</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="telework">ãƒ†ãƒ¬ãƒ¯ãƒ¼ã‚¯è©³ç´°</label>
                        <input type="text" id="telework" placeholder="é€±2-3æ—¥åœ¨å®…ç­‰">
                    </div>
                </div>

                
                <div class="form-actions">
                    <button type="button" onclick="closeModal('ankenModal')" class="secondary">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    <button type="submit">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Contact Modal -->
    <div id="contactModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>é€£çµ¡å…ˆè¿½åŠ </h3>
                <span class="close" onclick="closeModal('contactModal')">&times;</span>
            </div>
            <form id="contactForm">
                <div class="form-group">
                    <label for="account_id">å–å¼•å…ˆ *</label>
                    <select id="account_id" required>
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="contact_name">é€£çµ¡å…ˆå *</label>
                    <input type="text" id="contact_name" required placeholder="å±±ç”° å¤ªéƒ">
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label for="lastname">å§“</label>
                        <input type="text" id="lastname" placeholder="å±±ç”°" onInput="updateContactName()">
                    </div>
                    <div class="form-group">
                        <label for="firstname">å</label>
                        <input type="text" id="firstname" placeholder="å¤ªéƒ" onInput="updateContactName()">
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label for="jobtitle">å½¹è·</label>
                        <input type="text" id="jobtitle" placeholder="å–¶æ¥­éƒ¨é•·">
                    </div>
                    <div class="form-group">
                        <label for="department">éƒ¨ç½²</label>
                        <input type="text" id="department" placeholder="å–¶æ¥­éƒ¨">
                    </div>
                </div>
                

                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label for="telephone1">é›»è©±ç•ªå·</label>
                        <input type="text" id="telephone1" placeholder="03-1234-5678">
                    </div>
                    <div class="form-group">
                        <label for="mobilephone">æºå¸¯é›»è©±</label>
                        <input type="text" id="mobilephone" placeholder="090-1234-5678">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="email_address1">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                    <input type="email" id="email_address1" placeholder="yamada@company.com">
                </div>
                
                <div class="form-group">
                    <label for="address1_line1">ä½æ‰€</label>
                    <input type="text" id="address1_line1" placeholder="æ±äº¬éƒ½æ¸‹è°·åŒº...">
                </div>
                
                <div class="form-group">
                    <label for="description">å‚™è€ƒ</label>
                    <textarea id="description" rows="2" placeholder="è¿½åŠ æƒ…å ±"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="button" onclick="closeModal('contactModal')" class="secondary">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    <button type="submit">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Account Modal -->
    <div id="accountModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>å–å¼•å…ˆè¿½åŠ </h3>
                <span class="close" onclick="closeModal('accountModal')">&times;</span>
            </div>
            <form id="accountForm">
                <div class="form-group">
                    <label for="account_name">å–å¼•å…ˆå *</label>
                    <input type="text" id="account_name" required>
                </div>
                <div class="form-group">
                    <label for="account_number">å–å¼•å…ˆç•ªå·</label>
                    <input type="text" id="account_number">
                </div>
                <div class="form-group">
                    <label for="telephone1">é›»è©±ç•ªå·</label>
                    <input type="text" id="telephone1" placeholder="03-1234-5678">
                </div>
                <div class="form-group">
                    <label for="website_url">Webã‚µã‚¤ãƒˆ</label>
                    <input type="url" id="website_url" placeholder="https://www.company.com">
                </div>
                <div class="form-group">
                    <label for="address1_line1">ä½æ‰€</label>
                    <input type="text" id="address1_line1" placeholder="æ±äº¬éƒ½æ¸‹è°·åŒº...">
                </div>
                <div class="form-group">
                    <label for="industry_code">æ¥­ç•Œ</label>
                    <input type="text" id="industry_code" placeholder="ITãƒ»ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢">
                </div>
                <div class="form-group">
                    <label for="description">èª¬æ˜</label>
                    <textarea id="description" rows="3" placeholder="å–å¼•å…ˆã®è©³ç´°æƒ…å ±"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" onclick="closeModal('accountModal')" class="secondary">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    <button type="submit">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Details Modal -->
    <div id="detailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>æ¡ˆä»¶è©³ç´°</h3>
                <span class="close" onclick="closeModal('detailsModal')">&times;</span>
            </div>
            <div id="detailsContent">
                <!-- Details will be populated here -->
            </div>
            <div class="form-actions">
                <button onclick="closeModal('detailsModal')" class="secondary">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>

    <script>
        let currentAnkenId = null;
        let allAnken = []; // Store all anken data for filtering
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            setupEventListeners();
        });
        
        function setupEventListeners() {
            document.getElementById('ankenForm').addEventListener('submit', handleAnkenSubmit);
            document.getElementById('contactForm').addEventListener('submit', handleContactSubmit);
            document.getElementById('accountForm').addEventListener('submit', handleAccountSubmit);
        }
        
        function showSection(sectionName) {
            // Hide all sections
            const ankenSection = document.getElementById('ankenSection');
            const contactsSection = document.getElementById('contactsSection');
            const accountsSection = document.getElementById('accountsSection');
            
            if (ankenSection) ankenSection.style.display = 'none';
            if (contactsSection) contactsSection.style.display = 'none';
            if (accountsSection) accountsSection.style.display = 'none';
            
            // Show selected section
            const targetSection = document.getElementById(sectionName + 'Section');
            if (targetSection) {
                targetSection.style.display = 'block';
                
                // Load data for the section
                if (sectionName === 'anken') {
                    loadAnken();
                } else if (sectionName === 'contacts') {
                    loadContactsList();
                } else if (sectionName === 'accounts') {
                    loadAccountsList();
                }
            }
        }

        async function loadData() {
            await Promise.all([
                loadAnken(),
                loadAccounts(),
                loadContacts()
            ]);
        }
        
        async function loadAnken() {
            try {
                const response = await fetch('/api/anken');
                allAnken = await response.json();
                applyFilters();
            } catch (error) {
                console.error('Error loading anken:', error);
                document.getElementById('ankenGrid').innerHTML = 
                    '<div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #e74c3c;">ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</div>';
            }
        }
        
        async function loadAccounts() {
            try {
                const response = await fetch('/api/accounts');
                const accounts = await response.json();
                populateAccountSelect(accounts);
            } catch (error) {
                console.error('Error loading accounts:', error);
            }
        }
        
        async function loadContacts() {
            try {
                const response = await fetch('/api/contacts');
                const contacts = await response.json();
                populateContactSelect(contacts);
            } catch (error) {
                console.error('Error loading contacts:', error);
            }
        }
        
        function renderAnkenCards(anken) {
            const grid = document.getElementById('ankenGrid');
            
            if (anken.length === 0) {
                grid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #999;">æ¡ˆä»¶ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            
            grid.innerHTML = anken.map(item => `
                <div class="anken-card" onclick="viewAnkenDetails('${item.anken_id}')">
                    <div class="anken-header">
                        <h3 class="anken-title">${item.anken_name || 'ç„¡é¡Œ'}</h3>
                    </div>
                    
                    <div class="anken-info">
                        <div class="anken-info-item">
                            <span class="anken-info-label">é€£çµ¡å…ˆ</span>
                            <span class="anken-info-value">${item.contact_name || '-'}</span>
                        </div>
                        <div class="anken-info-item">
                            <span class="anken-info-label">å–å¼•å…ˆ</span>
                            <span class="anken-info-value">${item.account_name || '-'}</span>
                        </div>
                        <div class="anken-info-item">
                            <span class="anken-info-label">ä½œæ¥­å ´æ‰€</span>
                            <span class="anken-info-value">${item.location || '-'}</span>
                        </div>
                        <div class="anken-info-item">
                            <span class="anken-info-label">ä¾¡æ ¼</span>
                            <span class="anken-info-value">${item.price || '-'}</span>
                        </div>
                        <div class="anken-info-item">
                            <span class="anken-info-label">æœŸé–“</span>
                            <span class="anken-info-value">${item.start_date || '-'} ï½ ${item.end_date || '-'}</span>
                        </div>
                        <div class="anken-info-item">
                            <span class="anken-info-label">ãƒ†ãƒ¬ãƒ¯ãƒ¼ã‚¯ <small style="color: #999; font-size: 9px;">(ã€‡:ãƒ•ãƒ« â–³:éƒ¨åˆ† âœ•:å¸¸é§)</small></span>
                            <span class="anken-info-value">${getTeleworkDisplay(item.telework_yn)}</span>
                        </div>
                    </div>
                    
                    <div class="anken-tags">
                        ${item.process ? `<span class="anken-tag">ğŸ“‹ ${item.process}</span>` : ''}
                        ${item.program ? `<span class="anken-tag">ğŸ’» ${item.program}</span>` : ''}
                        ${item.platform ? `<span class="anken-tag">ğŸ“± ${item.platform}</span>` : ''}
                        ${item.framework ? `<span class="anken-tag">ğŸ”§ ${item.framework}</span>` : ''}
                    </div>
                    
                    <div class="anken-actions" onclick="event.stopPropagation();">
                        <button onclick="editAnken('${item.anken_id}')" class="secondary">ç·¨é›†</button>
                        <button onclick="deleteAnken('${item.anken_id}')" class="danger">å‰Šé™¤</button>
                    </div>
                </div>
            `).join('');
        }
        
        function populateAccountSelect(accounts) {
            const select = document.getElementById('account_id');
            select.innerHTML = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>' +
                accounts.map(account => 
                    `<option value="${account.account_id}">${account.account_name}</option>`
                ).join('');
                
            // Also populate industry filter for accounts section
            const industryFilter = document.getElementById('industryFilter');
            if (industryFilter) {
                industryFilter.innerHTML = '<option value="">ã™ã¹ã¦</option>';
                const uniqueIndustries = [...new Set(accounts.map(a => a.industry_code).filter(Boolean))];
                uniqueIndustries.forEach(industry => {
                    const option = document.createElement('option');
                    option.value = industry;
                    option.textContent = industry;
                    industryFilter.appendChild(option);
                });
            }
            
            // Populate contact account filter
            const contactAccountFilter = document.getElementById('contactAccountFilter');
            if (contactAccountFilter) {
                contactAccountFilter.innerHTML = '<option value="">ã™ã¹ã¦</option>';
                accounts.forEach(account => {
                    const option = document.createElement('option');
                    option.value = account.account_name;
                    option.textContent = account.account_name;
                    contactAccountFilter.appendChild(option);
                });
            }
        }
        
        function populateContactSelect(contacts) {
            const select = document.getElementById('contact_id');
            select.innerHTML = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>' +
                contacts.map(contact => 
                    `<option value="${contact.contact_id}">${contact.contact_name} (${contact.account?.account_name || 'æ‰€å±ãªã—'})</option>`
                ).join('');
        }

        async function loadContactsList() {
            try {
                const response = await fetch('/api/contacts');
                const contacts = await response.json();
                displayContacts(contacts);
            } catch (error) {
                console.error('Error loading contacts list:', error);
                const contactsGrid = document.getElementById('contactsGrid');
                if (contactsGrid) {
                    contactsGrid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #999;">æ‹…å½“è€…ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</div>';
                }
            }
        }

        function displayContacts(contacts) {
            const grid = document.getElementById('contactsGrid');
            if (!grid) return;
            
            if (contacts.length === 0) {
                grid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #999;">æ‹…å½“è€…ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            
            grid.innerHTML = contacts.map(contact => `
                <div class="anken-card">
                    <div class="anken-header">
                        <h3 class="anken-title">${contact.contact_name || '-'}</h3>
                    </div>
                    <div class="anken-info">
                        <div class="anken-info-item">
                            <span class="anken-info-label">å–å¼•å…ˆ</span>
                            <span class="anken-info-value">${contact.account?.account_name || '-'}</span>
                        </div>
                        <div class="anken-info-item">
                            <span class="anken-info-label">å½¹è·</span>
                            <span class="anken-info-value">${contact.jobtitle || '-'}</span>
                        </div>
                        <div class="anken-info-item">
                            <span class="anken-info-label">éƒ¨ç½²</span>
                            <span class="anken-info-value">${contact.department || '-'}</span>
                        </div>
                        <div class="anken-info-item">
                            <span class="anken-info-label">é›»è©±</span>
                            <span class="anken-info-value">${contact.telephone1 || '-'}</span>
                        </div>
                        <div class="anken-info-item">
                            <span class="anken-info-label">ãƒ¡ãƒ¼ãƒ«</span>
                            <span class="anken-info-value">${contact.email_address1 || '-'}</span>
                        </div>
                    </div>
                    <div class="anken-actions">
                        <button onclick="editContact('${contact.contact_id}')" class="secondary">ç·¨é›†</button>
                        <button onclick="deleteContact('${contact.contact_id}')" class="danger">å‰Šé™¤</button>
                    </div>
                </div>
            `).join('');
        }

        function applyContactFilters() {
            const searchText = document.getElementById('contactSearchText')?.value.toLowerCase() || '';
            const accountFilter = document.getElementById('contactAccountFilter')?.value || '';
            
            // Get contacts data and filter
            fetch('/api/contacts')
                .then(response => response.json())
                .then(allContacts => {
                    const filtered = allContacts.filter(contact => {
                        const matchesSearch = !searchText || 
                            (contact.contact_name && contact.contact_name.toLowerCase().includes(searchText)) ||
                            (contact.jobtitle && contact.jobtitle.toLowerCase().includes(searchText)) ||
                            (contact.department && contact.department.toLowerCase().includes(searchText));
                        
                        const matchesAccount = !accountFilter || (contact.account && contact.account.account_name === accountFilter);
                        
                        return matchesSearch && matchesAccount;
                    });
                    
                    displayContacts(filtered);
                })
                .catch(error => console.error('Error filtering contacts:', error));
        }

        async function loadAccountsList() {
            try {
                const response = await fetch('/api/accounts');
                const accounts = await response.json();
                displayAccounts(accounts);
            } catch (error) {
                console.error('Error loading accounts list:', error);
                const accountsGrid = document.getElementById('accountsGrid');
                if (accountsGrid) {
                    accountsGrid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #999;">å–å¼•å…ˆã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</div>';
                }
            }
        }

        function displayAccounts(accounts) {
            const grid = document.getElementById('accountsGrid');
            if (!grid) return;
            
            if (accounts.length === 0) {
                grid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #999;">å–å¼•å…ˆãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            
            grid.innerHTML = accounts.map(account => `
                <div class="anken-card">
                    <div class="anken-header">
                        <h3 class="anken-title">${account.account_name || '-'}</h3>
                    </div>
                    <div class="anken-info">
                        <div class="anken-info-item">
                            <span class="anken-info-label">æ¥­ç•Œ</span>
                            <span class="anken-info-value">${account.industry_code || '-'}</span>
                        </div>
                        <div class="anken-info-item">
                            <span class="anken-info-label">é›»è©±</span>
                            <span class="anken-info-value">${account.telephone1 || '-'}</span>
                        </div>
                        <div class="anken-info-item">
                            <span class="anken-info-label">ä½æ‰€</span>
                            <span class="anken-info-value">${account.address1_line1 || '-'}</span>
                        </div>
                        <div class="anken-info-item">
                            <span class="anken-info-label">ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆ</span>
                            <span class="anken-info-value">${account.website_url ? `<a href="${account.website_url}" target="_blank">${account.website_url}</a>` : '-'}</span>
                        </div>
                        <div class="anken-info-item">
                            <span class="anken-info-label">èª¬æ˜</span>
                            <span class="anken-info-value">${account.description || '-'}</span>
                        </div>
                    </div>
                    <div class="anken-actions">
                        <button onclick="editAccount('${account.account_id}')" class="secondary">ç·¨é›†</button>
                        <button onclick="deleteAccount('${account.account_id}')" class="danger">å‰Šé™¤</button>
                    </div>
                </div>
            `).join('');
        }

        function applyAccountFilters() {
            const searchText = document.getElementById('accountSearchText')?.value.toLowerCase() || '';
            const industryFilter = document.getElementById('industryFilter')?.value || '';
            
            // Get accounts data and filter
            fetch('/api/accounts')
                .then(response => response.json())
                .then(allAccounts => {
                    const filtered = allAccounts.filter(account => {
                        const matchesSearch = !searchText || 
                            (account.account_name && account.account_name.toLowerCase().includes(searchText)) ||
                            (account.industry_code && account.industry_code.toLowerCase().includes(searchText)) ||
                            (account.description && account.description.toLowerCase().includes(searchText));
                        
                        const matchesIndustry = !industryFilter || account.industry_code === industryFilter;
                        
                        return matchesSearch && matchesIndustry;
                    });
                    
                    displayAccounts(filtered);
                })
                .catch(error => console.error('Error filtering accounts:', error));
        }
        
        function getTeleworkDisplay(teleworkYn) {
            switch(teleworkYn) {
                case 2: return 'ã€‡';
                case 1: return 'â–³';
                case 0: return 'âœ•';
                default: return '-';
            }
        }
        
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
            if (modalId === 'ankenModal') {
                currentAnkenId = null;
                document.getElementById('ankenModalTitle').textContent = 'æ¡ˆä»¶ä½œæˆ';
                document.getElementById('ankenForm').reset();
            }
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function updateContactName() {
            const lastname = document.getElementById('lastname').value;
            const firstname = document.getElementById('firstname').value;
            
            if (lastname && firstname) {
                const contactName = `${lastname} ${firstname}`;
                document.getElementById('contact_name').value = contactName;
            }
        }
        
        async function handleAnkenSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = {
                anken_name: document.getElementById('anken_name').value,
                contact_id: document.getElementById('contact_id').value || null,
                detail: document.getElementById('detail').value,

                start_date: document.getElementById('start_date').value,
                end_date: document.getElementById('end_date').value,
                price: document.getElementById('price').value,
                process: document.getElementById('process').value,
                program: document.getElementById('program').value
            };
            
            try {
                const url = currentAnkenId ? `/api/anken/${currentAnkenId}` : '/api/anken';
                const method = currentAnkenId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    closeModal('ankenModal');
                    loadAnken(); // This will reload and reapply filters
                } else {
                    alert('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                console.error('Error saving anken:', error);
                alert('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }
        
        async function handleContactSubmit(e) {
            e.preventDefault();
            
            // Auto-generate contact_name from lastname + firstname if both are provided
            const lastname = document.getElementById('lastname').value;
            const firstname = document.getElementById('firstname').value;
            let contactName = document.getElementById('contact_name').value;
            
            if (lastname && firstname) {
                contactName = `${lastname} ${firstname}`;
                document.getElementById('contact_name').value = contactName;
            }
            
            const data = {
                contact_name: contactName,
                account_id: document.getElementById('account_id').value,
                firstname: firstname,
                lastname: lastname,
                fullname: contactName,
                jobtitle: document.getElementById('jobtitle').value,
                department: document.getElementById('department').value,
                telephone1: document.getElementById('telephone1').value,
                mobilephone: document.getElementById('mobilephone').value,
                email_address1: document.getElementById('email_address1').value,
                address1_line1: document.getElementById('address1_line1').value,
                description: document.getElementById('description').value
            };
            
            try {
                const response = await fetch('/api/contacts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    
                    // Show warning if duplicate name detected
                    if (result.warning) {
                        if (confirm(`${result.warning}\n\nç™»éŒ²ã‚’ç¶šè¡Œã—ã¾ã™ã‹ï¼Ÿ`)) {
                            closeModal('contactModal');
                            document.getElementById('contactForm').reset();
                            loadContacts();
                            const contactsSection = document.getElementById('contactsSection');
                            if (contactsSection && contactsSection.style.display !== 'none') {
                                loadContactsList(); // Refresh contacts list if visible
                            }
                        }
                    } else {
                        closeModal('contactModal');
                        document.getElementById('contactForm').reset();
                        loadContacts();
                        const contactsSection = document.getElementById('contactsSection');
                        if (contactsSection && contactsSection.style.display !== 'none') {
                            loadContactsList(); // Refresh contacts list if visible
                        }
                    }
                } else {
                    alert('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                console.error('Error saving contact:', error);
                alert('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }
        
        async function handleAccountSubmit(e) {
            e.preventDefault();
            
            const data = {
                account_name: document.getElementById('account_name').value
            };
            
            try {
                const response = await fetch('/api/accounts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    closeModal('accountModal');
                    document.getElementById('accountForm').reset();
                    loadAccounts();
                } else {
                    alert('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                console.error('Error saving account:', error);
                alert('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }
        
        async function editAnken(ankenId) {
            try {
                const response = await fetch(`/api/anken/${ankenId}`);
                const anken = await response.json();
                
                currentAnkenId = ankenId;
                document.getElementById('ankenModalTitle').textContent = 'æ¡ˆä»¶ç·¨é›†';
                
                // Populate form
                document.getElementById('anken_name').value = anken.anken_name || '';
                document.getElementById('contact_id').value = anken.contact_id || '';
                document.getElementById('detail').value = anken.detail || '';

                document.getElementById('start_date').value = anken.start_date || '';
                document.getElementById('end_date').value = anken.end_date || '';
                document.getElementById('price').value = anken.price || '';
                document.getElementById('process').value = anken.process || '';
                document.getElementById('program').value = anken.program || '';
                
                openModal('ankenModal');
            } catch (error) {
                console.error('Error loading anken for edit:', error);
                alert('æ¡ˆä»¶ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        async function editContact(contactId) {
            // Implementation for editing contacts
            console.log('Edit contact:', contactId);
        }

        async function deleteContact(contactId) {
            if (!confirm('ã“ã®æ‹…å½“è€…ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/contacts/${contactId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    loadContacts();
                    const contactsSection = document.getElementById('contactsSection');
                    if (contactsSection && contactsSection.style.display !== 'none') {
                        loadContactsList();
                    }
                } else {
                    alert('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                console.error('Error deleting contact:', error);
                alert('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        async function editAccount(accountId) {
            // Implementation for editing accounts
            console.log('Edit account:', accountId);
        }

        async function deleteAccount(accountId) {
            if (!confirm('ã“ã®å–å¼•å…ˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/accounts/${accountId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    loadAccounts();
                    const accountsSection = document.getElementById('accountsSection');
                    if (accountsSection && accountsSection.style.display !== 'none') {
                        loadAccountsList();
                    }
                } else {
                    alert('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                console.error('Error deleting account:', error);
                alert('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }
        
        async function deleteAnken(ankenId) {
            if (!confirm('ã“ã®æ¡ˆä»¶ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/anken/${ankenId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    loadAnken(); // This will reload and reapply filters
                } else {
                    alert('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                console.error('Error deleting anken:', error);
                alert('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }
        
        async function viewAnkenDetails(ankenId) {
            try {
                const response = await fetch(`/api/anken/${ankenId}`);
                const anken = await response.json();
                
                const detailsContent = document.getElementById('detailsContent');
                detailsContent.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <h4 style="margin-bottom: 15px; color: #333; border-bottom: 1px solid #eee; padding-bottom: 5px;">åŸºæœ¬æƒ…å ±</h4>
                            <div style="margin-bottom: 10px;"><strong>æ¡ˆä»¶å:</strong> ${anken.anken_name || '-'}</div>
                            <div style="margin-bottom: 10px;"><strong>é€£çµ¡å…ˆ:</strong> ${anken.contact_name || '-'}</div>
                            <div style="margin-bottom: 10px;"><strong>å–å¼•å…ˆ:</strong> ${anken.account_name || '-'}</div>
                            <div style="margin-bottom: 10px;"><strong>ä¾¡æ ¼:</strong> ${anken.price || '-'}</div>
                            <div style="margin-bottom: 10px;"><strong>å¥‘ç´„å½¢æ…‹:</strong> ${anken.contract || '-'}</div>
                        </div>
                        <div>
                            <h4 style="margin-bottom: 15px; color: #333; border-bottom: 1px solid #eee; padding-bottom: 5px;">æœŸé–“</h4>
                            <div style="margin-bottom: 10px;"><strong>é–‹å§‹æ—¥:</strong> ${anken.start_date || '-'}</div>
                            <div style="margin-bottom: 10px;"><strong>çµ‚äº†æ—¥:</strong> ${anken.end_date || '-'}</div>
                            <div style="margin-bottom: 10px;"><strong>ç· åˆ‡æ—¥:</strong> ${anken.limit_date || '-'}</div>
                            <div style="margin-bottom: 10px;"><strong>å‹¤å‹™æ™‚é–“:</strong> ${anken.time_from || '-'} ~ ${anken.time_to || '-'}</div>
                            <div style="margin-bottom: 10px;"><strong>äººæ•°:</strong> ${anken.persons || '-'}</div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <h4 style="margin-bottom: 15px; color: #333; border-bottom: 1px solid #eee; padding-bottom: 5px;">æŠ€è¡“è¦ä»¶</h4>
                            <div style="margin-bottom: 10px;"><strong>å·¥ç¨‹:</strong> ${anken.process || '-'}</div>
                            <div style="margin-bottom: 10px;"><strong>ãƒ—ãƒ­ã‚°ãƒ©ãƒ è¨€èª:</strong> ${anken.program || '-'}</div>
                            <div style="margin-bottom: 10px;"><strong>ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ :</strong> ${anken.platform || '-'}</div>
                            <div style="margin-bottom: 10px;"><strong>ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯:</strong> ${anken.framework || '-'}</div>
                            <div style="margin-bottom: 10px;"><strong>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹:</strong> ${anken.db || '-'}</div>
                        </div>
                        <div>
                            <h4 style="margin-bottom: 15px; color: #333; border-bottom: 1px solid #eee; padding-bottom: 5px;">å‹¤å‹™æ¡ä»¶</h4>
                            <div style="margin-bottom: 10px;"><strong>å‹¤å‹™åœ°:</strong> ${anken.location || '-'}</div>
                            <div style="margin-bottom: 10px;"><strong>éƒ½é“åºœçœŒ:</strong> ${anken.ken || '-'}</div>
                            <div style="margin-bottom: 10px;"><strong>ãƒ†ãƒ¬ãƒ¯ãƒ¼ã‚¯:</strong> 
                                ${getTeleworkDisplay(anken.telework_yn)} <small style="color: #999; font-size: 10px;">(ã€‡:ãƒ•ãƒ« â–³:éƒ¨åˆ† âœ•:å¸¸é§)</small>
                            </div>
                            <div style="margin-bottom: 10px;"><strong>ãƒ†ãƒ¬ãƒ¯ãƒ¼ã‚¯è©³ç´°:</strong> ${anken.telework || '-'}</div>
                            <div style="margin-bottom: 10px;"><strong>å¤–å›½äººå¯å¦:</strong> ${anken.foreigner || '-'}</div>
                        </div>
                    </div>
                    
                    ${anken.required_skills ? `
                        <div style="margin-bottom: 20px;">
                            <h4 style="margin-bottom: 10px; color: #333; border-bottom: 1px solid #eee; padding-bottom: 5px;">å¿…é ˆã‚¹ã‚­ãƒ«</h4>
                            <p style="line-height: 1.6; color: #666;">${anken.required_skills}</p>
                        </div>
                    ` : ''}
                    
                    ${anken.nice_skills ? `
                        <div style="margin-bottom: 20px;">
                            <h4 style="margin-bottom: 10px; color: #333; border-bottom: 1px solid #eee; padding-bottom: 5px;">æ­“è¿ã‚¹ã‚­ãƒ«</h4>
                            <p style="line-height: 1.6; color: #666;">${anken.nice_skills}</p>
                        </div>
                    ` : ''}
                    
                    ${anken.detail ? `
                        <div style="margin-bottom: 20px;">
                            <h4 style="margin-bottom: 10px; color: #333; border-bottom: 1px solid #eee; padding-bottom: 5px;">è©³ç´°èª¬æ˜</h4>
                            <p style="line-height: 1.6; color: #666;">${anken.detail}</p>
                        </div>
                    ` : ''}
                    
                    ${anken.notes ? `
                        <div style="margin-bottom: 20px;">
                            <h4 style="margin-bottom: 10px; color: #333; border-bottom: 1px solid #eee; padding-bottom: 5px;">å‚™è€ƒ</h4>
                            <p style="line-height: 1.6; color: #666;">${anken.notes}</p>
                        </div>
                    ` : ''}
                    

                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <h4 style="margin-bottom: 15px; color: #333; border-bottom: 1px solid #eee; padding-bottom: 5px;">æŠ€è¡“è¦ä»¶</h4>
                            <div style="margin-bottom: 10px;"><strong>å¿…é ˆã‚¹ã‚­ãƒ«:</strong> ${anken.required_skills || '-'}</div>
                            <div style="margin-bottom: 10px;"><strong>æ­“è¿ã‚¹ã‚­ãƒ«:</strong> ${anken.nice_skills || '-'}</div>
                            <div style="margin-bottom: 10px;"><strong>ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ :</strong> ${anken.platform || '-'}</div>
                            <div style="margin-bottom: 10px;"><strong>ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯:</strong> ${anken.framework || '-'}</div>
                            <div style="margin-bottom: 10px;"><strong>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹:</strong> ${anken.db || '-'}</div>
                        </div>
                        <div>
                            <h4 style="margin-bottom: 15px; color: #333; border-bottom: 1px solid #eee; padding-bottom: 5px;">å‹¤å‹™æ¡ä»¶</h4>
                            <div style="margin-bottom: 10px;"><strong>å ´æ‰€:</strong> ${anken.location || '-'}</div>
                            <div style="margin-bottom: 10px;"><strong>éƒ½é“åºœçœŒ:</strong> ${anken.ken || '-'}</div>
                            <div style="margin-bottom: 10px;"><strong>å‹¤å‹™æ™‚é–“:</strong> 
                                ${anken.time_from && anken.time_to ? `${anken.time_from} - ${anken.time_to}` : '-'}
                            </div>
                            <div style="margin-bottom: 10px;"><strong>å¥‘ç´„:</strong> ${anken.contract || '-'}</div>
                        </div>
                    </div>
                    
                    ${anken.notes ? `
                        <div style="margin-top: 20px;">
                            <h4 style="margin-bottom: 10px; color: #333; border-bottom: 1px solid #eee; padding-bottom: 5px;">å‚™è€ƒ</h4>
                            <p style="line-height: 1.6; color: #666;">${anken.notes}</p>
                        </div>
                    ` : ''}
                `;
                
                openModal('detailsModal');
            } catch (error) {
                console.error('Error loading anken details:', error);
                alert('æ¡ˆä»¶è©³ç´°ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }
        
        function applyFilters() {
            const searchText = document.getElementById('searchText').value.toLowerCase();
            const filterLocation = document.getElementById('filterLocation').value.toLowerCase();
            const filterKen = document.getElementById('filterKen').value;
            const filterProgram = document.getElementById('filterProgram').value.toLowerCase();
            const filterPlatform = document.getElementById('filterPlatform').value.toLowerCase();
            const filterProcess = document.getElementById('filterProcess').value.toLowerCase();

            const filterTelework = document.getElementById('filterTelework').value;
            
            const filteredAnken = allAnken.filter(item => {
                // Text search in name and detail
                const textMatch = !searchText || 
                    (item.anken_name && item.anken_name.toLowerCase().includes(searchText)) ||
                    (item.detail && item.detail.toLowerCase().includes(searchText));
                
                // Location filter
                const locationMatch = !filterLocation || 
                    (item.location && item.location.toLowerCase().includes(filterLocation));
                
                // Prefecture filter
                const kenMatch = !filterKen || item.ken === filterKen;
                
                // Programming language filter
                const programMatch = !filterProgram || 
                    (item.program && item.program.toLowerCase().includes(filterProgram));
                
                // Platform filter
                const platformMatch = !filterPlatform || 
                    (item.platform && item.platform.toLowerCase().includes(filterPlatform));
                
                // Process filter
                const processMatch = !filterProcess || 
                    (item.process && item.process.toLowerCase().includes(filterProcess));
                
                // Telework filter
                const teleworkMatch = !filterTelework || 
                    (filterTelework === 'full' && item.telework_yn === 2) ||
                    (filterTelework === 'partial' && item.telework_yn === 1) ||
                    (filterTelework === 'none' && item.telework_yn === 0);
                
                return textMatch && locationMatch && kenMatch && programMatch && 
                       platformMatch && processMatch && teleworkMatch;
            });
            
            renderAnkenCards(filteredAnken);
            updateResultCount(filteredAnken.length, allAnken.length);
        }
        
        function clearFilters() {
            document.getElementById('searchText').value = '';
            document.getElementById('filterLocation').value = '';
            document.getElementById('filterKen').value = '';
            document.getElementById('filterProgram').value = '';
            document.getElementById('filterPlatform').value = '';
            document.getElementById('filterProcess').value = '';
            document.getElementById('filterTelework').value = '';
            applyFilters();
        }
        
        function updateResultCount(filtered, total) {
            const resultCount = document.getElementById('resultCount');
            if (filtered === total) {
                resultCount.textContent = `${total}ä»¶ã®æ¡ˆä»¶`;
            } else {
                resultCount.textContent = `${filtered}ä»¶è¡¨ç¤º / å…¨${total}ä»¶`;
            }
        }
        
        // Close modal when clicking outside
        window.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        });
    </script>
</body>
</html>